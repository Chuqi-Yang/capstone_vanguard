


--	Given the RDC ORGID of the ultimate parent, use the below query to extract all the subsidiary fund managers and funds under management.


with Q as 
( 
SELECT  F.LGCYINVESTORID    AS FUND
       ,F.FULLNAME          AS FUNDNAME
       ,M.LGCYINVESTORID    AS MANAGER
       ,M.FULLNAME          AS MANAGERNAME
       ,R.INVESTORID        AS MANAGER_INVESTORID  
       ,R.EFFECTFROMDATE
       ,R.EFFECTTODATE
       ,B3.COMNAME          AS ULTIMATE_PARENT
       ,B3.GEMPERMID        AS PARENT_INVESTORID
       ,B3.ORGID
FROM OWN2FUNDMGRRELNCHG R  
JOIN OWN2INVRESUME F                                    
       ON F.LGCYINVESTORID = R.LGCYFUNDID       -- FUND INFO 
       AND R.EFFECTFROMDATE= (SELECT MAX(EFFECTFROMDATE) FROM OWN2FUNDMGRRELNCHG WHERE LGCYINVESTORID=R.LGCYINVESTORID AND LGCYFUNDID=R.LGCYFUNDID)
JOIN OWN2INVRESUME M  
       ON M.LGCYINVESTORID = R.LGCYINVESTORID  -- MANAGER INFO  
JOIN RDCORGINFO R1
       ON R.INVESTORID=R1.GEMPERMID     
CROSS APPLY (SELECT TOP 1 VALUE_ FROM RDCHISTLNDATA WHERE ENTITYID=R1.ORGID AND ITEM=34659 AND SEQNO='1' ORDER BY STARTDATE DESC) E  
LEFT JOIN RDCORGINFO B3
       ON B3.ORGID = E.VALUE_
​
UNION
SELECT  F.LGCYINVESTORID       AS FUND
        , F.FULLNAME           AS FUNDNAME
        , NULL                 AS MANAGER
        , NULL                 AS MANAGERNAME
        , NULL                 AS MANAGER_INVESTORID      
        , R.EFFECTFROMDATE
        , R.EFFECTTODATE
        , R1.COMNAME           AS ULTIMATE_PARENT
        , R.INVESTORID         AS PARENT_INVESTORID
        , R1.ORGID
FROM OWN2FUNDMGRRELNCHG R
JOIN OWN2INVRESUME F
    ON F.LGCYINVESTORID = R.lgcyfundID              -- FUND INFO 
    AND R.EFFECTFROMDATE= (SELECT MAX(EFFECTFROMDATE) FROM OWN2FUNDMGRRELNCHG WHERE LGCYINVESTORID=R.LGCYINVESTORID AND LGCYFUNDID=R.LGCYFUNDID)
JOIN OWN2INVRESUME M
    ON R.LGCYINVESTORID = M.LgcyInvestorId          -- ULTIMATE_PARENT
JOIN RDCORGINFO R1
    ON R1.GEMPERMID = R.INVESTORID
)
​
select * from Q 
Where ORGID = '116550' --BlackRock Inc ('116550' --BlackRock Inc; 81763 for Vanguard Group Inc)

order by Q.manager
--- When the Manager is null, it refers the case that the funds are managed directly by the ultimate parent.

