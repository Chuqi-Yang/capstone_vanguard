SELECT 
 
OM.INSTRID,RR.COMNAME,RR.INSTRTYPE,OM.LGCYINVESTORID,IR.FULLNAME,P.HOLDDATE,P.OWNERSHIPID,P.EFFECTFROMDATE,P.EFFECTTODATE,
P.FILINGTYPECODE,A3.DESC_,P.PCTSHOUTHLD, P.SHSHLD,P.SHSHLDVAL, S.EQASSETHOLDVAL, (P.SHSHLDVAL / S.EQASSETHOLDVAL) AS PCTPORTFOLIO
 
 FROM OWN2OWNERMAP OM
      LEFT   JOIN  RDCINSTRINFO RR
          ON RR.GEMPERMID=OM.INSTRID     --OWN2 MAPPING

     LEFT JOIN OWN2INVRESUME IR
      ON OM.LGCYINVESTORID = IR.LGCYINVESTORID
    
 LEFT JOIN OWN2CHOLDDET P         -- RETURNS THE CONSOLIDATED HOLDINGS
     ON P.OWNERSHIPID=OM.OWNERSHIPID
     AND P.HOLDDATE >= '2016-06-30'      --GIVEN MONTH END
     AND P.HoldDate <= '2020-06-30'
	 AND P.FILINGTYPECODE = 1 -- 13F

 LEFT JOIN OWN2INVEQASSET S
	ON IR.LGCYINVESTORID = S.LGCYINVESTORID
	AND P.HOLDDATE BETWEEN S.EFFECTFROMDATE AND S.EFFECTTODATE
	AND S.CALCBASISCODE = 1 -- MONTHLY
     
 LEFT  JOIN OWN2CODE A3
       ON P.FILINGTYPECODE=A3.CODE
       AND A3.TYPE_='3'             --FILING SOURCE    
   
WHERE  OM.LGCYINVESTORID='2006452' -- VANGUARD 
  AND P.PCTSHOUTHLD IS NOT NULL AND P.PCTSHOUTHLD<>0 